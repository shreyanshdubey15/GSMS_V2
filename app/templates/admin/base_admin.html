{% extends "base.html" %}

{% block navbar %}
{% include "partials/_navbar.html" %}
{% endblock %}

{% block content %}
<div class="admin-wrapper">
    <!-- Sidebar -->
    <nav id="admin-sidebar" class="admin-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-store-alt fa-2x me-2"></i>
                <span class="brand-text">Admin Panel</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <ul class="sidebar-menu">
            <!-- Dashboard -->
            <li class="menu-item">
                <a href="{{ url_for('admin.dashboard') }}" class="menu-link{% if request.endpoint == 'admin.dashboard' %} active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">Dashboard</span>
                </a>
            </li>

            <!-- Analytics Section -->
            <li class="menu-section">
                <span class="menu-section-title">
                    <i class="fas fa-chart-line"></i> Analytics
                </span>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.analytics') }}" class="menu-link{% if request.endpoint == 'admin.analytics' %} active{% endif %}">
                    <i class="fas fa-chart-bar"></i>
                    <span class="menu-text">Analytics & Reports</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.sales_report') }}" class="menu-link{% if request.endpoint == 'admin.sales_report' %} active{% endif %}">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span class="menu-text">Sales Report</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.profit_analysis') }}" class="menu-link{% if request.endpoint == 'admin.profit_analysis' %} active{% endif %}">
                    <i class="fas fa-chart-pie"></i>
                    <span class="menu-text">Profit Analysis</span>
                </a>
            </li>

            <!-- Inventory Section -->
            <li class="menu-section">
                <span class="menu-section-title">
                    <i class="fas fa-boxes"></i> Inventory
                </span>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.products') }}" class="menu-link{% if 'products' in request.endpoint %} active{% endif %}">
                    <i class="fas fa-cube"></i>
                    <span class="menu-text">Products</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.inventory_report') }}" class="menu-link{% if request.endpoint == 'admin.inventory_report' %} active{% endif %}">
                    <i class="fas fa-warehouse"></i>
                    <span class="menu-text">Inventory Report</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.bulk_import') }}" class="menu-link{% if request.endpoint == 'admin.bulk_import' %} active{% endif %}">
                    <i class="fas fa-upload"></i>
                    <span class="menu-text">Bulk Import</span>
                </a>
            </li>

            <!-- Management Section -->
            <li class="menu-section">
                <span class="menu-section-title">
                    <i class="fas fa-users-cog"></i> Management
                </span>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.customers') }}" class="menu-link{% if request.endpoint == 'admin.customers' %} active{% endif %}">
                    <i class="fas fa-user-friends"></i>
                    <span class="menu-text">Customers</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.suppliers') }}" class="menu-link{% if request.endpoint == 'admin.suppliers' %} active{% endif %}">
                    <i class="fas fa-truck"></i>
                    <span class="menu-text">Suppliers</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.employees') }}" class="menu-link{% if 'employees' in request.endpoint %} active{% endif %}">
                    <i class="fas fa-user-tie"></i>
                    <span class="menu-text">Employees</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.orders') }}" class="menu-link{% if 'orders' in request.endpoint %} active{% endif %}">
                    <i class="fas fa-receipt"></i>
                    <span class="menu-text">Orders</span>
                </a>
            </li>

            <!-- System Section -->
            <li class="menu-section">
                <span class="menu-section-title">
                    <i class="fas fa-cogs"></i> System
                </span>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.notifications') }}" class="menu-link{% if request.endpoint == 'admin.notifications' %} active{% endif %}">
                    <i class="fas fa-bell"></i>
                    <span class="menu-text">Notifications</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.backup') }}" class="menu-link{% if request.endpoint == 'admin.backup' %} active{% endif %}">
                    <i class="fas fa-save"></i>
                    <span class="menu-text">Backup</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.audit_log') }}" class="menu-link{% if request.endpoint == 'admin.audit_log' %} active{% endif %}">
                    <i class="fas fa-history"></i>
                    <span class="menu-text">Audit Log</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.system_health') }}" class="menu-link{% if request.endpoint == 'admin.system_health' %} active{% endif %}">
                    <i class="fas fa-heartbeat"></i>
                    <span class="menu-text">System Health</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.maintenance') }}" class="menu-link{% if request.endpoint == 'admin.maintenance' %} active{% endif %}">
                    <i class="fas fa-tools"></i>
                    <span class="menu-text">Maintenance</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.user_management') }}" class="menu-link{% if request.endpoint == 'admin.user_management' %} active{% endif %}">
                    <i class="fas fa-user-shield"></i>
                    <span class="menu-text">User Management</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.settings') }}" class="menu-link{% if request.endpoint == 'admin.settings' %} active{% endif %}">
                    <i class="fas fa-sliders-h"></i>
                    <span class="menu-text">Settings</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="{{ url_for('admin.theme_test') }}" class="menu-link{% if request.endpoint == 'admin.theme_test' %} active{% endif %}">
                    <i class="fas fa-palette"></i>
                    <span class="menu-text">Theme Test</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="admin-main">
        <!-- Top Header Bar -->
        <header class="admin-header">
            <div class="header-left">
                <button class="sidebar-mobile-toggle" id="sidebarMobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="breadcrumb">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="{{ url_for('admin.dashboard') }}">
                                    <i class="fas fa-home"></i>
                                </a>
                            </li>
                            {% if request.endpoint == 'admin.dashboard' %}
                                <li class="breadcrumb-item active">Dashboard</li>
                            {% elif request.endpoint == 'admin.analytics' %}
                                <li class="breadcrumb-item active">Analytics</li>
                            {% elif request.endpoint == 'admin.sales_report' %}
                                <li class="breadcrumb-item active">Sales Report</li>
                            {% elif request.endpoint == 'admin.profit_analysis' %}
                                <li class="breadcrumb-item active">Profit Analysis</li>
                            {% elif 'products' in request.endpoint %}
                                <li class="breadcrumb-item active">Products</li>
                            {% elif request.endpoint == 'admin.inventory_report' %}
                                <li class="breadcrumb-item active">Inventory Report</li>
                            {% elif request.endpoint == 'admin.bulk_import' %}
                                <li class="breadcrumb-item active">Bulk Import</li>
                            {% elif request.endpoint == 'admin.customers' %}
                                <li class="breadcrumb-item active">Customers</li>
                            {% elif request.endpoint == 'admin.suppliers' %}
                                <li class="breadcrumb-item active">Suppliers</li>
                            {% elif 'employees' in request.endpoint %}
                                <li class="breadcrumb-item active">Employees</li>
                            {% elif 'orders' in request.endpoint %}
                                <li class="breadcrumb-item active">Orders</li>
                            {% elif request.endpoint == 'admin.notifications' %}
                                <li class="breadcrumb-item active">Notifications</li>
                            {% elif request.endpoint == 'admin.backup' %}
                                <li class="breadcrumb-item active">Backup</li>
                            {% elif request.endpoint == 'admin.audit_log' %}
                                <li class="breadcrumb-item active">Audit Log</li>
                            {% elif request.endpoint == 'admin.system_health' %}
                                <li class="breadcrumb-item active">System Health</li>
                            {% elif request.endpoint == 'admin.maintenance' %}
                                <li class="breadcrumb-item active">Maintenance</li>
                            {% elif request.endpoint == 'admin.user_management' %}
                                <li class="breadcrumb-item active">User Management</li>
                            {% elif request.endpoint == 'admin.settings' %}
                                <li class="breadcrumb-item active">Settings</li>
                            {% endif %}
                        </ol>
                    </nav>
                </div>
            </div>

            <div class="header-right">
                <!-- Search Bar -->
                <form class="header-search d-none d-md-flex" method="GET" action="{{ url_for('admin.products') }}">
                    <div class="input-group">
                        <input class="form-control" type="search" name="search"
                               placeholder="Search products..." value="{{ request.args.get('search', '') }}">
                        <button class="btn btn-outline-secondary" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>

                <!-- Notifications -->
                <div class="header-notifications dropdown">
                    <button class="btn btn-link position-relative" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end notification-dropdown">
                        <li><h6 class="dropdown-header">Notifications</h6></li>
                        <li><a class="dropdown-item" href="#">
                            <div class="notification-icon bg-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Low Stock Alert</div>
                                <div class="notification-text">Apple has only 5 items left</div>
                                <div class="notification-time">2 min ago</div>
                            </div>
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <div class="notification-icon bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Order Completed</div>
                                <div class="notification-text">Order #1234 processed successfully</div>
                                <div class="notification-time">15 min ago</div>
                            </div>
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <div class="notification-icon bg-info">
                                <i class="fas fa-info"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">System Update</div>
                                <div class="notification-text">Database optimization completed</div>
                                <div class="notification-time">1 hour ago</div>
                            </div>
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-center" href="{{ url_for('admin.notifications') }}">
                            View All Notifications
                        </a></li>
                    </ul>
                </div>

                <!-- Dark Mode Toggle -->
                <button class="btn btn-link theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>

                <!-- User Menu -->
                <div class="header-user dropdown">
                    <button class="btn btn-link d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name ms-2 d-none d-lg-block">{{ current_user.username }}</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><h6 class="dropdown-header">{{ current_user.username }}</h6></li>
                        <li><a class="dropdown-item" href="{{ url_for('admin.settings') }}">
                            <i class="fas fa-user-cog me-2"></i>Profile Settings
                        </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('admin.user_management') }}">
                            <i class="fas fa-users-cog me-2"></i>User Management
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a></li>
                    </ul>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="admin-content">
            {% include "partials/_flash.html" %}
            {% block admin_content %}{% endblock %}
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Dark Mode Toggle
document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    if (!themeToggle) {
        return;
    }

    const icon = themeToggle.querySelector('i');

    // Check for saved theme preference or default to light mode
    const currentTheme = localStorage.getItem('admin-theme') || 'light';
    body.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
    }

    themeToggle.addEventListener('click', function() {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';

        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('admin-theme', newTheme);

        if (newTheme === 'dark') {
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        } else {
            icon.classList.remove('fa-sun');
            icon.classList.add('fa-moon');
        }
    });


    // Sidebar Toggle
    const sidebar = document.getElementById('admin-sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarMobileToggle = document.getElementById('sidebarMobileToggle');

    function toggleSidebar() {
        sidebar.classList.toggle('collapsed');
    }

    sidebarToggle.addEventListener('click', toggleSidebar);
    sidebarMobileToggle.addEventListener('click', toggleSidebar);

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(event) {
        if (window.innerWidth < 768) {
            if (!sidebar.contains(event.target) && !sidebarMobileToggle.contains(event.target)) {
                sidebar.classList.remove('show');
            }
        }
    });
});
</script>
{% endblock %}